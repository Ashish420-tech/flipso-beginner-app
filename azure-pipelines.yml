trigger:
- main

pool:
  name: Default

stages:
# =========================
# STAGE 1: CI
# =========================
- stage: CI
  displayName: 'Continuous Integration'
  jobs:
  - job: Build
    displayName: 'Build Application'
    steps:
    - task: UseDotNet@2
      inputs:
        packageType: 'sdk'
        version: '8.x'

    - script: dotnet restore
      displayName: 'Restore dependencies'

    - script: dotnet build --no-restore
      displayName: 'Build application'

    - script: dotnet publish -c Release -o $(Build.ArtifactStagingDirectory)
      displayName: 'Publish build output'

    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact'
      inputs:
        pathToPublish: '$(Build.ArtifactStagingDirectory)'
        artifactName: 'drop'

# =========================
# STAGE 2: CD (NO DEPLOY YET)
# =========================
- stage: CD
  displayName: 'Continuous Deployment'
  dependsOn: CI
  condition: succeeded()
  jobs:
  - job: Approval
    displayName: 'Manual Approval Gate'
    pool: server
    steps:
    - task: ManualValidation@0
      inputs:
        notifyUsers: |
          ashish.mondal.linkedin2025@gmail.com
        instructions: |
          Review the CI build artifacts and approve to proceed with deployment.
        onTimeout: reject
        timeoutInMinutes: 1440
